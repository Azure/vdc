interactions:
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: HEAD
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/vdc-storage-rg?api-version=2018-05-01
  response:
    body: {string: ''}
    headers:
      cache-control: [no-cache]
      content-length: ['0']
      date: ['Fri, 11 Jan 2019 18:47:30 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      x-content-type-options: [nosniff]
    status: {code: 204, message: No Content}
- request:
    body: '{"sku": {"name": "Standard_LRS"}, "kind": "BlobStorage", "location": "Central
      US", "properties": {"encryption": {"services": {"blob": {"enabled": true}},
      "keySource": "Microsoft.Storage"}, "accessTier": "Cool", "supportsHttpsTrafficOnly":
      true, "isHnsEnabled": false}}'
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Length: ['268']
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 azure-mgmt-storage/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/vdc-storage-rg/providers/Microsoft.Storage/storageAccounts/storage?api-version=2018-02-01
  response:
    body: {string: '{"sku":{"name":"Standard_LRS","tier":"Standard"},"kind":"BlobStorage","id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/vdc-storage-rg/providers/Microsoft.Storage/storageAccounts/storage","name":"storage","type":"Microsoft.Storage/storageAccounts","location":"centralus","tags":{},"properties":{"isHnsEnabled":false,"networkAcls":{"bypass":"AzureServices","virtualNetworkRules":[],"ipRules":[],"defaultAction":"Allow"},"supportsHttpsTrafficOnly":true,"encryption":{"services":{"file":{"enabled":true,"lastEnabledTime":"2019-01-11T18:35:45.2178641Z"},"blob":{"enabled":true,"lastEnabledTime":"2019-01-11T18:35:45.2178641Z"}},"keySource":"Microsoft.Storage"},"accessTier":"Cool","provisioningState":"Succeeded","creationTime":"2019-01-11T18:35:45.1084128Z","primaryEndpoints":{"dfs":"https://storage.dfs.core.windows.net/","blob":"https://storage.blob.core.windows.net/","table":"https://storage.table.core.windows.net/"},"primaryLocation":"centralus","statusOfPrimary":"available"}}'}
    headers:
      cache-control: [no-cache]
      content-length: ['1039']
      content-type: [application/json]
      date: ['Fri, 11 Jan 2019 18:47:30 GMT']
      expires: ['-1']
      pragma: [no-cache]
      server: ['Microsoft-Azure-Storage-Resource-Provider/1.0,Microsoft-HTTPAPI/2.0
          Microsoft-HTTPAPI/2.0']
      strict-transport-security: [max-age=31536000; includeSubDomains]
      transfer-encoding: [chunked]
      vary: [Accept-Encoding]
      x-content-type-options: [nosniff]
      x-ms-ratelimit-remaining-subscription-writes: ['1199']
    status: {code: 200, message: OK}
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Length: ['0']
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 azure-mgmt-storage/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: POST
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/vdc-storage-rg/providers/Microsoft.Storage/storageAccounts/storage/listKeys?api-version=2018-02-01
  response:
    body: {string: '{"keys":[{"keyName":"key1","value":"abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA==","permissions":"FULL"},{"keyName":"key2","value":"i6qj7OB3AYeCFizUvPPi6d9uSvbMkEdVmGDVwhwTw9qmtFo597nyvohXgOMiDzYb8nMuu1ER9gumkA66Fi+tEw==","permissions":"FULL"}]}'}
    headers:
      cache-control: [no-cache]
      content-length: ['288']
      content-type: [application/json]
      date: ['Fri, 11 Jan 2019 18:47:31 GMT']
      expires: ['-1']
      pragma: [no-cache]
      server: ['Microsoft-Azure-Storage-Resource-Provider/1.0,Microsoft-HTTPAPI/2.0
          Microsoft-HTTPAPI/2.0']
      strict-transport-security: [max-age=31536000; includeSubDomains]
      transfer-encoding: [chunked]
      vary: [Accept-Encoding]
      x-content-type-options: [nosniff]
      x-ms-ratelimit-remaining-subscription-writes: ['1199']
    status: {code: 200, message: OK}
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Length: ['0']
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 azure-mgmt-storage/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: POST
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/vdc-storage-rg/providers/Microsoft.Storage/storageAccounts/storage/listKeys?api-version=2018-02-01
  response:
    body: {string: '{"keys":[{"keyName":"key1","value":"abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA==","permissions":"FULL"},{"keyName":"key2","value":"i6qj7OB3AYeCFizUvPPi6d9uSvbMkEdVmGDVwhwTw9qmtFo597nyvohXgOMiDzYb8nMuu1ER9gumkA66Fi+tEw==","permissions":"FULL"}]}'}
    headers:
      cache-control: [no-cache]
      content-length: ['288']
      content-type: [application/json]
      date: ['Fri, 11 Jan 2019 18:49:10 GMT']
      expires: ['-1']
      pragma: [no-cache]
      server: ['Microsoft-Azure-Storage-Resource-Provider/1.0,Microsoft-HTTPAPI/2.0
          Microsoft-HTTPAPI/2.0']
      strict-transport-security: [max-age=31536000; includeSubDomains]
      transfer-encoding: [chunked]
      vary: [Accept-Encoding]
      x-content-type-options: [nosniff]
      x-ms-ratelimit-remaining-subscription-writes: ['1199']
    status: {code: 200, message: OK}
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: HEAD
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg?api-version=2018-05-01
  response:
    body: {string: ''}
    headers:
      cache-control: [no-cache]
      content-length: ['113']
      content-type: [application/json; charset=utf-8]
      date: ['Fri, 11 Jan 2019 18:49:12 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      x-content-type-options: [nosniff]
      x-ms-failure-cause: [gateway]
    status: {code: 404, message: Not Found}
- request:
    body: '{"location": "Central US"}'
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Length: ['26']
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg?api-version=2018-05-01
  response:
    body: {string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/org-onprem-net-rg","name":"org-onprem-net-rg","location":"centralus","properties":{"provisioningState":"Succeeded"}}'}
    headers:
      cache-control: [no-cache]
      content-length: ['198']
      content-type: [application/json; charset=utf-8]
      date: ['Fri, 11 Jan 2019 18:49:12 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      x-content-type-options: [nosniff]
      x-ms-ratelimit-remaining-subscription-writes: ['1199']
    status: {code: 201, message: Created}
- request:
    body: 'b''b\''{"properties": {"template": {"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
      "contentVersion": "1.0.0.0", "parameters": {"deployment-prefix": {"type": "string",
      "metadata": {"description": ""}}, "network-security-groups": {"type": "array",
      "metadata": {"description": ""}}, "sas-key": {"defaultValue": "se=2019-01-12T18%3A49%3A11Z&sp=r&spr=https&sv=2018-03-28&ss=b&srt=o&sig=dv6ZACuOD3JXj510bAq%2BjbshfXdTw4KtDMrTwM6blqU%3D",
      "type": "string"}, "output-params-storage-key": {"defaultValue": "abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA==",
      "type": "string"}, "output-params-storage-account-name": {"defaultValue": "storage",
      "type": "string"}}, "resources": [{"apiVersion": "2017-10-01", "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[concat(parameters(\\\''deployment-prefix\\\''), \\\''-\\\'', parameters(\\\''network-security-groups\\\'')[copyIndex()].name,
      \\\''-nsg\\\'')]", "copy": {"count": "[length(parameters(\\\''network-security-groups\\\''))]",
      "name": "nsgLoop"}, "location": "[resourceGroup().location]", "properties":
      {"securityRules": "[parameters(\\\''network-security-groups\\\'')[copyIndex()].rules]"}}],
      "outputs": {}}, "parameters": {"deployment-prefix": {"value": "org-onprem"},
      "network-security-groups": {"value": [{"name": "default", "rules": [{"name":
      "allow-rdp", "properties": {"access": "Allow", "destinationPortRange": "3389",
      "destinationAddressPrefix": "VirtualNetwork", "direction": "Inbound", "priority":
      100, "protocol": "*", "sourcePortRange": "*", "sourceAddressPrefix": "VirtualNetwork"}}]}]},
      "sas-key": {"value": "se=2019-01-12T18%3A49%3A11Z&sp=r&spr=https&sv=2018-03-28&ss=b&srt=o&sig=dv6ZACuOD3JXj510bAq%2BjbshfXdTw4KtDMrTwM6blqU%3D"},
      "output-params-storage-key": {"value": "abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA=="},
      "output-params-storage-account-name": {"value": "storage"}}, "mode": "Incremental"}}\'''''
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      Content-Length: ['1967']
      Content-Type: [application/json; charset=utf-8]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
      accept-language: [en-US]
    method: PUT
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg?api-version=2018-05-01
  response:
    body: {string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg","name":"org-on-premises-onprem-deployment-nsg","properties":{"templateHash":"11958411307360498011","parameters":{"deployment-prefix":{"type":"String","value":"org-onprem"},"network-security-groups":{"type":"Array","value":[{"name":"default","rules":[{"name":"allow-rdp","properties":{"access":"Allow","destinationPortRange":"3389","destinationAddressPrefix":"VirtualNetwork","direction":"Inbound","priority":100,"protocol":"*","sourcePortRange":"*","sourceAddressPrefix":"VirtualNetwork"}}]}]},"sas-key":{"type":"String","value":"se=2019-01-12T18%3A49%3A11Z&sp=r&spr=https&sv=2018-03-28&ss=b&srt=o&sig=dv6ZACuOD3JXj510bAq%2BjbshfXdTw4KtDMrTwM6blqU%3D"},"output-params-storage-key":{"type":"String","value":"abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA=="},"output-params-storage-account-name":{"type":"String","value":"storage"}},"mode":"Incremental","provisioningState":"Accepted","timestamp":"2019-01-11T18:49:15.678196Z","duration":"PT0.7498239S","correlationId":"5e315331-1602-4a13-80f5-f108148678b5","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"networkSecurityGroups","locations":["centralus"]}]}],"dependencies":[]}}'}
    headers:
      azure-asyncoperation: ['https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg/operationStatuses/08586543743305492527?api-version=2018-05-01']
      cache-control: [no-cache]
      content-length: ['1423']
      content-type: [application/json; charset=utf-8]
      date: ['Fri, 11 Jan 2019 18:49:15 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      x-content-type-options: [nosniff]
      x-ms-ratelimit-remaining-subscription-writes: ['1199']
    status: {code: 201, message: Created}
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg/operationStatuses/08586543743305492527?api-version=2018-05-01
  response:
    body: {string: '{"status":"Succeeded"}'}
    headers:
      cache-control: [no-cache]
      content-length: ['22']
      content-type: [application/json; charset=utf-8]
      date: ['Fri, 11 Jan 2019 18:49:45 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      vary: [Accept-Encoding]
      x-content-type-options: [nosniff]
    status: {code: 200, message: OK}
- request:
    body: null
    headers:
      Accept: [application/json]
      Accept-Encoding: ['gzip, deflate']
      Connection: [keep-alive]
      User-Agent: [python/3.6.4 (Linux-4.9.125-linuxkit-x86_64-with) msrest/0.6.2
          msrest_azure/0.6.0 resourcemanagementclient/2.0.0 Azure-SDK-For-Python]
    method: GET
    uri: https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg?api-version=2018-05-01
  response:
    body: {string: '{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/org-onprem-net-rg/providers/Microsoft.Resources/deployments/org-on-premises-onprem-deployment-nsg","name":"org-on-premises-onprem-deployment-nsg-1547232553253","properties":{"templateHash":"11958411307360498011","parameters":{"deployment-prefix":{"type":"String","value":"org-onprem"},"network-security-groups":{"type":"Array","value":[{"name":"default","rules":[{"name":"allow-rdp","properties":{"access":"Allow","destinationPortRange":"3389","destinationAddressPrefix":"VirtualNetwork","direction":"Inbound","priority":100,"protocol":"*","sourcePortRange":"*","sourceAddressPrefix":"VirtualNetwork"}}]}]},"sas-key":{"type":"String","value":"se=2019-01-12T18%3A49%3A11Z&sp=r&spr=https&sv=2018-03-28&ss=b&srt=o&sig=dv6ZACuOD3JXj510bAq%2BjbshfXdTw4KtDMrTwM6blqU%3D"},"output-params-storage-key":{"type":"String","value":"abhilQXu5bl0SupY1dseiX95b6eBNA6R0Ho0d9FbHpTFC+B1cEUhgWr9oIEagQXGdilU5raOIpH5Pq/XVv7ifA=="},"output-params-storage-account-name":{"type":"String","value":"storage"}},"mode":"Incremental","provisioningState":"Succeeded","timestamp":"2019-01-11T18:49:27.855761Z","duration":"PT12.9273889S","correlationId":"5e315331-1602-4a13-80f5-f108148678b5","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"networkSecurityGroups","locations":["centralus"]}]}],"dependencies":[],"outputs":{},"outputResources":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/org-onprem-net-rg/providers/Microsoft.Network/networkSecurityGroups/org-onprem-default-nsg"}]}}'}
    headers:
      cache-control: [no-cache]
      content-length: ['1633']
      content-type: [application/json; charset=utf-8]
      date: ['Fri, 11 Jan 2019 18:49:46 GMT']
      expires: ['-1']
      pragma: [no-cache]
      strict-transport-security: [max-age=31536000; includeSubDomains]
      vary: [Accept-Encoding]
      x-content-type-options: [nosniff]
    status: {code: 200, message: OK}
- request:
    body: null
    headers:
      Connection: [keep-alive]
      User-Agent: [Azure-Storage/1.4.0-1.3.1 (Python CPython 3.6.4; Linux 4.9.125-linuxkit)]
      x-ms-date: ['Fri, 11 Jan 2019 18:49:47 GMT']
      x-ms-version: ['2018-03-28']
    method: GET
    uri: https://storage.blob.core.windows.net/output?restype=container
  response:
    body: {string: "\uFEFF<?xml version=\"1.0\" encoding=\"utf-8\"?><Error><Code>ContainerNotFound</Code><Message>The\
        \ specified container does not exist.\nRequestId:660914fd-a01e-0031-4cde-a9c0c6000000\n\
        Time:2019-01-11T18:49:47.4614221Z</Message></Error>"}
    headers:
      content-length: ['225']
      content-type: [application/xml]
      date: ['Fri, 11 Jan 2019 18:49:46 GMT']
      server: [Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0]
      x-ms-error-code: [ContainerNotFound]
      x-ms-version: ['2018-03-28']
    status: {code: 404, message: The specified container does not exist.}
- request:
    body: null
    headers:
      Connection: [keep-alive]
      Content-Length: ['0']
      User-Agent: [Azure-Storage/1.4.0-1.3.1 (Python CPython 3.6.4; Linux 4.9.125-linuxkit)]
      x-ms-date: ['Fri, 11 Jan 2019 18:49:47 GMT']
      x-ms-version: ['2018-03-28']
    method: PUT
    uri: https://storage.blob.core.windows.net/output?restype=container
  response:
    body: {string: ''}
    headers:
      date: ['Fri, 11 Jan 2019 18:49:46 GMT']
      etag: ['"0x8D677F58F5F4F8F"']
      last-modified: ['Fri, 11 Jan 2019 18:49:47 GMT']
      server: [Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0]
      transfer-encoding: [chunked]
      x-ms-version: ['2018-03-28']
    status: {code: 201, message: Created}
- request:
    body: '{}'
    headers:
      Connection: [keep-alive]
      Content-Length: ['2']
      User-Agent: [Azure-Storage/1.4.0-1.3.1 (Python CPython 3.6.4; Linux 4.9.125-linuxkit)]
      x-ms-blob-type: [BlockBlob]
      x-ms-date: ['Fri, 11 Jan 2019 18:49:47 GMT']
      x-ms-version: ['2018-03-28']
    method: PUT
    uri: https://storage.blob.core.windows.net/output/org-on-premises-onprem/parameters/nsg/azureDeploy.parameters.output.json
  response:
    body: {string: ''}
    headers:
      content-md5: [mZFLkyvTelC5g8XnyQrpOw==]
      date: ['Fri, 11 Jan 2019 18:49:47 GMT']
      etag: ['"0x8D677F58F723C4A"']
      last-modified: ['Fri, 11 Jan 2019 18:49:47 GMT']
      server: [Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0]
      transfer-encoding: [chunked]
      x-ms-request-server-encrypted: ['true']
      x-ms-version: ['2018-03-28']
    status: {code: 201, message: Created}
version: 1
